<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.w3.org/1999/xhtml" layout:decorate="~{_layout/seller/index}">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<th:block layout:fragment="pageContent">
    <main id="main" class="main">
        <div class="container-fluid">
            <div class="container-fluid">
                <div class="card" style="min-width: 920px;">
                    <div class="card-body">
                        <h1 class="card-title fw-semibold mb-4" style="font-size:30px;">  상품 조회/수정  </h1>
                        <form id="productForm" method="post" action="/productsUpdate" th:action="@{productsUpdate}" enctype="multipart/form-data">
                            <div class="card mb-0" style="float:left; width: 50%; height: 100%;" th:object="${productDTO}">
                                <div class="card-body">
                                    <input type="hidden" id="productIdHi" name="productIdHi" th:field="*{productId}">
                                    <input type="hidden" id="categoryIdHi" name="categoryIdHi" th:field="*{categoryId}">
                                    <div class="mb-3">
                                        <label for="productcode" class="form-label">Code</label>
                                        <input type="text" class="form-control" id="productcode" aria-describedby="emailHelp" th:field="*{productCode}" readonly>
                                        <div id="emailHelp" class="form-text">상품 코드 작성 양식 : {판매자 아이디}{상품 코드}{상품 색상}</div>
                                    </div>
                                    <div style="width: 430px; height: 450px;">
                                        <label for="preview" class="form-label">상품 이미지 미리보기</label>
                                        <img th:src="${getProductImage}" alt="productImage" id="preview" style="max-width: 400px; max-height: 400px;">
                                    </div>
                                    <div class="mb-3">
                                        <label for="file" class="form-label">이미지 업로드</label>
                                        <input type="file" name="file" class="form-control" id="file" onchange="previewImage(event);">
                                        <div id="file-text" class="form-text"></div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="productname" class="form-label">이름</label>
                                        <input type="text" class="form-control" id="productname" th:field="*{productName}">
                                    </div>
                                    <div class="mb-3">
                                        <label for="productprice" class="form-label">가격</label>
                                        <input type="number" class="form-control" id="productprice" th:field="*{productPrice}">
                                    </div>
                                    <div class="mb-3">
                                        <label for="productdiscount" class="form-label">할인율</label>
                                        <input type="number" class="form-control" id="productdiscount" th:field="*{productDiscount}">
                                    </div>
                                    <div class="mb-3">
                                        <label for="hashText" class="form-label">해시태그</label>
                                        <div class="input-group mb-3">
                                            <input type="text" id="hashText" name="hashText" class="form-control" placeholder="해시태그 입력" aria-label="Recipient's username" aria-describedby="button-addon2">
                                            <button class="btn btn-outline-secondary" type="button" id="addHashBtn" name="addHashBtn">추가</button>
                                            <button class="btn btn-outline-secondary" type="button" id="delHashBtn" name="delHashBtn">삭제</button>
                                        </div>
                                        <div id="hashtag-container">
                                            <div th:each="hashtagList : ${hashtagList}" th:if="${hashtagList != null and #lists.isEmpty(hashtagList) == false}" id="hashtag-box" name="hashtag-box" class="hashtag-box" th:text="${hashtagList}"></div>
                                        </div>
                                    </div>
                                    <div class="mb-3" >
                                        <label for="productexplain" class="form-label">설명</label>
                                        <div id="productexplain-text" class="form-text">html 코드 작성</div>
                                        <textarea style="height: 200px;" class="form-control" id="productexplain" th:field="*{productExplain}"></textarea>
                                    </div>
                                </div>
                            </div>

                            <div class="card" style="width: 50%; height: 100%; min-width: 430px" th:object="${productDetailDTO}" >
                                <div class="card-body">
                                    <div>
                                        <input type="hidden" id="productDetailIdHi" name="productDetailIdHi" th:field="*{productDetailId}">
                                        <div class="mb-3">
                                            <label for="productmate" class="form-label">소재</label>
                                            <input type="text" class="form-control" id="productmate" th:field="*{productDetailMate}">
                                        </div>
                                        <div class="mb-3">
                                            <label for="productheight" class="form-label">굽높이</label>
                                            <input type="text" class="form-control" id="productheight" th:field="*{productDetailHeight}">
                                        </div>
                                        <div class="mb-3">
                                            <label for="productmaker" class="form-label">제조자</label>
                                            <input type="text" class="form-control" id="productmaker" th:field="*{productDetailMaker}">
                                        </div>
                                        <div class="mb-3">
                                            <label for="productcountry" class="form-label">제조국</label>
                                            <input type="text" class="form-control" id="productcountry" th:field="*{productDetailCountry}">
                                        </div>
                                        <div class="mb-3">
                                            <label for="productcolor" class="form-label">색상</label>
                                            <input type="text" class="form-control" id="productcolor" th:field="*{productDetailColor}">
                                        </div>
                                        <div class="mb-3">
                                            <label for="addStock-count" class="form-label">치수(재고)</label>
                                            <div class="input-group mb-3">
                                                <input type="number" id="addStock-size" name="addStock-text" class="form-control" placeholder="사이즈 입력" aria-describedby="button-addon2">
                                                <input type="number" id="addStock-count" name="addStock-text" class="form-control" placeholder="수량 입력" aria-describedby="button-addon2">
                                                <button class="btn btn-outline-secondary" type="button" id="addStockBtn" name="addStockBtn">추가</button>
                                            </div>
                                            <div id="stock-container">
                                                <div  class="input-group input-group-sm mb-3" style="float:left; width: 33%;" th:each="stock : ${stockList}" th:object="${stock}">
                                                    <span class="input-group-text" id="stockSize" name="stockSize" th:text="${stock.stockSize}"></span>
                                                    <input type="number" class="form-control" placeholder="수량 입력" aria-describedby="inputGroup-sizing-sm" th:value="*{stockCount}">
                                                    <button class="btn btn-outline-secondary" type="button" id="delStockBtn" name="delStockBtn">삭제</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3" style="clear: left;">
                                            <label for="productyear" class="form-label">제조년월</label>
                                            <input type="text" class="form-control" id="productyear" th:field="*{productDetailYear}">
                                        </div>
                                        <div class="mb-3">
                                            <label for="productas" class="form-label">A/S 책임자와 전화번호</label>
                                            <input type="text" class="form-control" id="productas" th:field="*{productDetailAs}">
                                        </div>
                                        <div class="mb-3">
                                            <label for="productwarning" class="form-label">소재별 관리방법</label>
                                            <textarea style="height:185px;" class="form-control" id="productwarning" th:field="*{productDetailWarning}"></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label for="productstandard" class="form-label">품질보증기준</label>
                                            <textarea style="height:185px;" type="text" class="form-control" id="productstandard" th:field="*{productDetailStandard}"></textarea>
                                        </div>
                                        <label for="category" class="form-label">카테고리</label>
                                        <div class="mb-3">
                                            <div style="min-width:135px; float:left;">
                                                <select id="category" class="form-select">
                                                    <th:block th:each="category : ${category}"
                                                              th:if="${category.categoryDef == 0}">
                                                        <option th:value="${category.categoryId}"
                                                                th:text="${category.categoryName}"
                                                                th:selected="${category.categoryId == sCategory.categoryId}"></option>
                                                    </th:block>
                                                </select>
                                            </div>
                                            <div style="width:135px; float:left;">
                                                <select id="subCategory" class="form-select">
                                                    <th:block th:each="category : ${category}"
                                                              th:if="${category.categoryParentId == ssubCategory.categoryParentId}">
                                                        <option th:value="${category.categoryId}"
                                                                th:text="${category.categoryName}"
                                                                th:selected="${category.categoryId == ssubCategory.categoryId}"></option>
                                                    </th:block>
                                                </select>
                                            </div>
                                            <div style="width:135px; float:left;">
                                                <select id="subSubCategory" class="form-select">
                                                    <th:block th:each="category : ${category}"
                                                              th:if="${category.categoryParentId == ssubSubCategory.categoryParentId}">
                                                        <option th:value="${category.categoryId}"
                                                                th:text="${category.categoryName}"
                                                                th:selected="${category.categoryId == ssubSubCategory.categoryId}"></option>
                                                    </th:block>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <button style="float: left; width: 50%" id="saveButton" name="saveButton" type="submit" class="btn btn-outline-primary">수정</button>
                                    <button style="width: 50%" id="delButton" name="delButton" type="submit" class="btn btn-outline-danger" onclick="deleteProduct()">삭제</button>
                                </div>
                                <div>
                                    <input type="hidden" id="totalHash" name="totalHash" value="">
                                    <input type="hidden" id="totalStock" name="totalStock" value="">
                                    <input type="hidden" id="newCategoryId" name="newCategoryId" value="">
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/js/pdList.js"></script>
    <script>
        function previewImage(event) {
            var reader = new FileReader();
            reader.onload = function(){
                var output = document.getElementById('preview');
                output.src = reader.result;
            };
            reader.readAsDataURL(event.target.files[0]);
        }

        function deleteProduct() {
            if (confirm('정말로 이 상품을 삭제하시겠습니까?')) {
                var form = document.getElementById('productForm');
                form.action = '/seller/pm/del';Add
                form.submit();
            }
        }


    </script>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#category').change(function() {
                var categoryId = $(this).val();
                if (categoryId) {
                    $.ajax({
                        url: '/seller/pm/proc/subcategories/' + categoryId,
                        type: "GET",
                        success: function(data) {
                            $('#subCategory').empty();
                            $('#subSubCategory').empty();
                            $('#subCategory').append('<option value="">==미선택==</option>');
                            $('#subSubCategory').append('<option value="">==미선택==</option>');
                            $.each(data, function(key, value) {
                                $('#subCategory').append('<option value="'+ value.categoryId +'">'+ value.categoryName +'</option>');
                            });
                            // 추가적인 로직이 필요하다면 여기에 추가
                        }
                    });
                } else {
                    $('#subCategory').empty();
                    $('#subCategory').append('<option value="">Select SubCategory</option>');
                    // 추가적인 로직이 필요하다면 여기에 추가
                }
            });
        });

        $(document).ready(function() {
            $('#subCategory').change(function() {
                var categoryId = $(this).val();
                if (categoryId) {
                    $.ajax({
                        url: '/seller/pm/proc/subSubcategories/' + categoryId,
                        type: "GET",
                        success: function(data) {
                            $('#subSubCategory').empty();
                            $('#subSubCategory').append('<option value="">==미선택==</option>');
                            $.each(data, function(key, value) {
                                $('#subSubCategory').append('<option value="'+ value.categoryId +'">'+ value.categoryName +'</option>');
                            });
                            // 추가적인 로직이 필요하다면 여기에 추가
                        }
                    });
                } else {
                    $('#subSubCategory').empty();
                    $('#subSubCategory').append('<option value="">Select SubCategory</option>');
                    // 추가적인 로직이 필요하다면 여기에 추가
                }
            });
        });

        $(document).ready(function() {
            $('#subSubCategory').change(function() {
                var categoryId = $(this).val();
                $('#newCategoryId').val(categoryId);
            });
        });

        //초기값 설정
        var categoryId = $('#subSubCategory').val();
        $('#newCategoryId').val(categoryId);
    </script>
</th:block>
</html>
