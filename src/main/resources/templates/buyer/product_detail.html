<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{_layout/index}">
<th:block layout:fragment="pageStyle">
    <style>
        .line-through {
        position: relative; /* 상대 위치 지정 */
        display: inline-block; /* 인라인 블록 요소로 설정하여 텍스트와 함께 나타나도록 함 */
        }
        .line-through::after {
            content: ""; /* 가상 요소의 내용 설정 */
            position: absolute; /* 절대 위치 지정 */
            top: 40%; /* 부모 요소의 상단에서 50% 떨어진 위치 */
            left: 0; /* 왼쪽 정렬 */
            width: 100%; /* 가로 전체 길이 */
            height: 1.3px; /* 줄의 두께 */
            background-color: black; /* 줄의 색상 */
        }
        .tabs {
            display: flex;
            border-bottom: 2px solid #000;
        }

        .tab {
            flex: 1;
            padding: 10px 0;
            text-align: center;
            cursor: pointer;
            border: 1px solid #000;
            border-bottom: none;
            box-sizing: border-box;
            border-bottom: 1px solid black !important;
        }

        .tab.active {
            font-weight: bold !important;
            background-color: #fff !important;
            border: 2px solid #black;
            border-bottom: 0px solid black !important;
        }

        .tab-content {
            display: none;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }
        .table {
            width: 50%;
            border-collapse: collapse;
            margin: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        th {
            text-align: left;
            background-color: #f2f2f2;
        }
        .form-control option:disabled {
            background-color: #cccccc; /* 회색 배경색 */
        }
        .form-control:focus {
            outline: none; /* 기본 outline을 제거합니다 */
            border: 2px solid black; /* 테두리 색상을 검정색으로 설정합니다 */
        }
        .low-stock {
            color: red; /* 품절임박 옵션의 폰트 색상 빨간색 */
        }
        .form-separator {
            margin-top: 30px; /* 수평선 위쪽 여백 추가 */
            margin-bottom: 10px; /* 수평선 아래쪽 여백 추가 */
            border: 0; /* 기본 테두리 제거 */
            border-top: 1.4px solid #666; /* 회색 수평선 추가 */
        }
        .star_rating {
          width: 100%;
          box-sizing: border-box;
          display: inline-flex;
          float: left;
          flex-direction: row;
          justify-content: flex-start;
        }
        .star_rating .star {
          width: 25px;
          height: 25px;
          margin-right: 10px;
          display: inline-block;
          background: url('/assets/image/Star.png') no-repeat;
          background-size: 100%;
          box-sizing: border-box;
        }
        .star_rating .star.on {
          width: 25px;
          height: 25px;
          margin-right: 10px;
          display: inline-block;
          background: url('/assets/image/colorStar.png') no-repeat;
          background-size: 100%;
          box-sizing: border-box;
        }
        .star_rating .review-star {
          width: 25px;
          height: 25px;
          margin-right: 10px;
          display: inline-block;
          background: url('/assets/image/Star.png') no-repeat;
          background-size: 100%;
          box-sizing: border-box;
        }
        .star_rating .review-star.on {
          width: 25px;
          height: 25px;
          margin-right: 10px;
          display: inline-block;
          background: url('/assets/image/colorStar.png') no-repeat;
          background-size: 100%;
          box-sizing: border-box;
        }
        .review_box {
          width: 1000px;
          box-sizing: border-box;
          display: inline-block;
          margin: 15px 0;
          background: #F3F4F8;
          border: 0;
          border-radius: 10px;
          height: 100px; /* 높이를 50px로 설정하여 버튼과 맞춤 */
          resize: none;
          padding: 15px;
          font-size: 13px;
          font-family: sans-serif;
          vertical-align: top; /* 상단 정렬 */
        }

        .btn02 {
          display: inline-block; /* inline-block으로 변경하여 가로 배치 */
          width: 80px; /* 버튼의 너비를 100px로 설정 */
          font-weight: bold;
          border: 0;
          border-radius: 10px;
          height: 100px; /* 텍스트 영역과 높이 맞춤 */
          padding: 15px 0;
          font-size: 1.1em;
          text-align: center;
          background: bisque;
          margin-left: 10px; /* 텍스트 영역과 버튼 사이에 간격 추가 */
          margin-top: 15px;
          vertical-align: top; /* 상단 정렬 */
        }
        .file-list {
            height: 170px;
            overflow: auto;
            border: 1px solid #989898;
            padding: 10px;
        }
        .file-list .filebox {
            display: inline;
            align-items: center;
            gap: 5px;
            margin-rigth:20px;
        }

        .file-list .filebox p {
            font-size: 14px;
            margin-top: 10px;
            display: inline-block;
        }
        .file-list .filebox .delete i {
            color: #ff5353;
            margin-left: 5px;
            cursor: pointer;
        }
        .preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .preview-container img {
            max-width: 100px;
            max-height: 100px;
            border: 1px solid black;
        }
        .delete{
            color:RED;
        }
        #productimage{
            display:none;
        }
    </style>
</th:block>
<th:block layout:fragment="pageContent">
    <div th:each="productDetailList : ${productDetail}">
    <section class="single-product">
        <div class="container">
            <div class="row mt-20" style="margin-top:50px">
                <div class="col-md-5">
                    <div class="single-product-slider">
                            <div class='item active' style="width:400px; height:400px; margin-bottom:100px;">
                                <img th:src="@{'/assets/image/pMain/' + ${productDetailList.productImageSname} + ${productDetailList.productImageExtension}}"
                                     alt='' th:data-zoom-image="@{'/assets/image/pMain' + ${productDetailList.productImageSname} + ${productDetailList.productImageExtension}}"
                                    style="width:100%"/>
                            </div>
                    </div>
                </div>
                <div class="col-md-7">
                    <div class="single-product-details">
                        <h3 th:text="${productDetailList.productDetailMaker}"></h3>
                        <h1 th:text="${productDetailList.productName}"></h1>
                        <p th:text="상품코드+ ':' +${productDetailList.productCode}" style="font-size:20px;"></p>

                        <div th:if="${productDetailList.productDiscount==0}">
                            <h2 th:text="${productSummaryList.productPrice}"></h2>
                        </div>
                        <div th:if="${productDetailList.productDiscount!=0}" style="display:flex; flex=direction:column;">
                            <h3 class="line-through" th:text="${productDetailList.productPrice+'원'}" style="color:#666; margin-right:10px; margin-top:5px;"></h3>
                            <h2 th:text="${(100 - productDetailList.productDiscount) * productDetailList.productPrice / 100 + '원'}" style="color:red; margin-right:10px;"></h2>
                            <h3 th:text="${'['+productDetailList.productDiscount+'%]'}" style="margin-top:5px; color:red;"></h3>
                        </div>

                        <div class="product-size">
                            <span>Size:</span>
                            <select class="form-control" id="stockSelect">
                                <option th:each="stock : ${stockList}"
                                        th:text="${stock.stockCount == 0 ? stock.stockSize + 'mm (재고없음)'
                                                   : (stock.stockCount < 20 ? stock.stockSize + 'mm (품절임박)' : stock.stockSize + 'mm')}"
                                        th:value="${productDetailList.productDiscount == 0 ? productDetailList.productPrice + '원'
                                                    : ((100 - productDetailList.productDiscount) * productDetailList.productPrice / 100) + '원'}"
                                        th:classappend="${stock.stockCount < 20 && stock.stockCount != 0 ? 'low-stock' : ''}"
                                        th:disabled="${stock.stockCount == 0}">
                                </option>
                            </select>
                            <script>
                            $(document).ready(function() {
                                function updateTotalPrice() {
                                    var totalPrice = 0;
                                    $('#selectedOption .option-item').each(function() {
                                        var itemPrice = parseInt($(this).find('h3:last').text().replace('원', ''));
                                        totalPrice += itemPrice;
                                    });
                                    $('#totalPrice h1').text(totalPrice + '원');
                                }

                                $('#stockSelect').change(function() {
                                    var selectedText = $(this).find('option:selected').text().replace(/\s*\(.*?\)\s*/g, '');
                                    var selectedValue = parseInt($(this).find('option:selected').val().replace('원', ''));
                                    var existingItem = null;

                                    // 중복 항목 찾기
                                    $('#selectedOption .option-item').each(function() {
                                        if ($(this).find('h3:first').text() === selectedText) {
                                            existingItem = $(this);
                                            return false; // break loop
                                        }
                                    });

                                    if (existingItem) {
                                        // 중복 항목이 있으면 카운터 값 증가
                                        var counterValue = parseInt(existingItem.find('.counter-value').text());
                                        existingItem.find('.counter-value').text(counterValue + 1);
                                        existingItem.find('h3:last').text(selectedValue * (counterValue + 1) + '원');
                                    } else {
                                        // 중복 항목이 없으면 새 항목 추가
                                        var selectedOptionText = '<hr style="border: 1px; margin:0px; background-color:black;">' +
                                                                 '<div class="container option-item">' +
                                                                    '<div class="row">' +
                                                                        '<div class="col-sm-4" style="text-align: right;">' +
                                                                            '<h3 style="display: inline-block; margin:10px;">' + selectedText + '</h3>' +
                                                                        '</div>' +
                                                                        '<div class="col-sm-4">' +
                                                                            '<div class="counter-container" style="display: flex; justify-content: center; align-items: center;margin: 5px;">' +
                                                                                '<button class="counter-btn btn btn-outline-dark" id="decrementBtn">-</button>' +
                                                                                '<div class="counter-value-container" style="width:40px; text-align: center;">' +
                                                                                    '<span class="counter-value" id="counterValue">1</span>' +
                                                                                '</div>' +
                                                                                '<button class="counter-btn btn btn-outline-dark" id="incrementBtn">+</button>' +
                                                                            '</div>' +
                                                                        '</div>' +
                                                                        '<div class="col-sm-4" style="text-align: left;">' +
                                                                            '<h3 style="display: inline-block; margin:10px; color: red;">' + selectedValue + '원</h3>' +
                                                                            '<button class="close-btn" id="closeBtn" style="background: none; border: none; font-size: 20px; margin-left: 10px;">X</button>' +
                                                                        '</div>' +
                                                                    '</div>' +
                                                                 '</div>';
                                        $('#selectedOption').append(selectedOptionText);
                                    }
                                    updateTotalPrice(); // 총 결제 금액 업데이트
                                });

                                // 이벤트 위임을 사용하여 동적으로 생성된 버튼에 이벤트를 적용
                                $('#selectedOption').on('click', '.counter-btn', function() {
                                    var counterValueContainer = $(this).siblings('.counter-value-container').find('.counter-value');
                                    var counterValue = parseInt(counterValueContainer.text());
                                    var selectedText = $(this).closest('.option-item').find('h3:first').text();
                                    var selectedValue = 0;

                                    // 옵션의 값을 찾기 위해 stockSelect에서 다시 찾기
                                    $('#stockSelect option').each(function() {
                                        if ($(this).text().replace(/\s*\(.*?\)\s*/g, '') === selectedText) {
                                            selectedValue = parseInt($(this).val().replace('원', ''));
                                            return false; // break loop
                                        }
                                    });

                                    if ($(this).attr('id') === 'incrementBtn') {
                                        counterValueContainer.text(counterValue + 1);
                                        $(this).closest('.option-item').find('h3:last').text(selectedValue * (counterValue + 1) + '원');
                                    } else if ($(this).attr('id') === 'decrementBtn' && counterValue > 1) {
                                        counterValueContainer.text(counterValue - 1);
                                        $(this).closest('.option-item').find('h3:last').text(selectedValue * (counterValue - 1) + '원');
                                    }
                                    updateTotalPrice(); // 총 결제 금액 업데이트
                                });
                                $('#selectedOption').on('click', '.close-btn', function() {
                                    $(this).closest('.option-item').prev('hr').remove(); // 이전 hr 삭제
                                    $(this).closest('.option-item').next('hr').remove(); // 다음 hr 삭제
                                    $(this).closest('.option-item').remove();
                                    updateTotalPrice(); // 총 결제 금액 업데이트
                                });
                            });
                            </script>

                            <hr class="form-separator">
                            <div id="selectedOption" style="background: #f0f1f4;"></div>
                            <div class="container d-flex justify-content-between align-items-center" id="totalPrice" style="margin-top: 20px;">
                                <h3 class="container-text">총 결제금액</h3>
                                <h1 class="container-totalPrice" style="color:RED; margin-bottom: 0;">0원</h1>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: center;">
                            <button type="button" id="cartInsert" class="btn btn-secondary" style="width:370px; height:60px; margin-top:30px; margin-right:30px;">장바구니</button>
                            <button type="button" class="btn btn-dark" style="width:370px; height:60px; margin-top:30px;">바로구매</button>
                        </div>
                        <script>
                            $(document).ready(function(){
                                $('#cartInsert').on('click', function(event){
                                    event.preventDefault();
                                    var cartItems = [];
                                    $('#selectedOption .option-item').each(function(){
                                        var productId = $('.product_Id').val();
                                        var sizeText = $(this).find('h3:first').text();
                                        var size = sizeText.replace('mm', '').trim(); // 'mm' 제거 및 공백 제거
                                        var quantity = parseInt($(this).find('.counter-value').text());
                                        cartItems.push({
                                            product: { productId: productId }, // 수정: product 필드로 감싸기
                                            cartProductSize: size,
                                            cartProductCount: quantity
                                        });
                                    });

                                    $.ajax({
                                        url: '/cart/insert',
                                        type: 'POST',
                                        contentType: 'application/json',
                                        data: JSON.stringify(cartItems),
                                        success: function(result){
                                            alert('장바구니에 추가되었습니다.');
                                        },
                                        error: function(err) {
                                            alert('장바구니 추가에 실패했습니다.');
                                        }
                                    });
                                });
                            });
                        </script>
                    </div>
                </div>
            </div>
            <div class="row" style="margin-top:20px;">
                <div class="col-xs-12" style="width: 1200px;">
                    <div class="tabCommon mt-20">
                        <div class="tab-container">
                            <div class="row">
                                <div class="tab active col" data-tab="product-info">상품정보</div>
                                <div class="tab col" data-tab="product-reviews">상품후기</div>
                            </div>
                        </div>
                        <div class="tab-content" id="product-info">
                            <div th:utext="${productDetailList.productExplain}" style="margin-left:130px;"></div>
                            <div class="container" style="display:flex; justify-content:center; width:1600px;">
                                <table class="table table-striped">
                                    <tr>
                                        <th>소재</th>
                                        <td th:text="${productDetailList.productDetailMate}"></td>
                                    </tr>
                                    <tr>
                                        <th>색상</th>
                                        <td th:text="${productDetailList.productDetailColor}"></td>
                                    </tr>
                                    <tr>
                                        <th>치수</th>
                                        <td th:text="${productDetailList.productDetailSize}"></td>
                                    </tr>
                                    <tr>
                                        <th>굽높이</th>
                                        <td th:text="${productDetailList.productDetailHeight}"></td>
                                    </tr>
                                    <tr>
                                        <th>제조자</th>
                                        <td th:text="${productDetailList.productDetailMaker}"></td>
                                    </tr>
                                </table>
                                <table class="table table-striped">
                                    <tr>
                                        <th>제조국</th>
                                        <td th:text="${productDetailList.productDetailCountry}"></td>
                                    </tr>
                                    <tr>
                                        <th>A/S 전화번호</th>
                                        <td th:text="${productDetailList.productDetailAs}"></td>
                                    </tr>
                                    <tr>
                                        <th>제조년월</th>
                                        <td th:text="${productDetailList.productDetailYear}"></td>
                                    </tr>
                                    <tr>
                                        <th>품질보증기준</th>
                                        <td th:text="${productDetailList.productDetailStandard}"></td>
                                    </tr>
                                    <tr>
                                        <th>소재별 관리방법</th>
                                        <td th:text="${productDetailList.productDetailWaring}"></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class="tab-content" id="product-reviews">
                            <div class="review-container" id="reviewFormContainer">
                                <input type="hidden" class="product_Id" th:value="${productDetailList.productId}">
                                <div>
                                    <h2>리뷰 등록</h2>
                                    <hr style="border: 1px; color:black; ">
                                </div>
                                <div class="star_rating">
                                    <span class="star on" value="1"></span>
                                    <span class="star" value="2"></span>
                                    <span class="star" value="3"></span>
                                    <span class="star" value="4"></span>
                                    <span class="star" value="5"></span>
                                    <span class="rating-value"></span> <!-- 값을 표시할 span 추가 -->
                                </div>
                                <div style="width: 400px; height: 170px;">
                                    <label for="preview-container" class="form-label">리뷰 이미지 미리보기</label>
                                    <div class="preview-container" id="preview-container"></div>
                                </div>
                                <div class="mb-3">
                                    <label for="productimage" class="form-label">이미지 업로드</label>
                                    <label class="custom-file-upload btn btn-dark">
                                        파일 선택
                                        <input type="file" id="productimage" multiple>
                                    </label>
                                    <div class="file-list" style="height:67px;"></div>
                                </div>
                                <script>
                                    $(document).ready(function() {
                                        var fileNo = 0;
                                        var filesArr = [];
                                        var ratingValue = 0; // 별점 값 초기화

                                        // 별점 관련 코드
                                        function updateRatingValue(value) {
                                            $('.star_rating .rating-value').text('별점 : ' + value + '점');
                                            ratingValue = value; // 별점 값 업데이트
                                        }

                                        $('.star_rating > .star').click(function() {
                                            $(this).parent().children('span').removeClass('on');
                                            $(this).addClass('on').prevAll('span').addClass('on');
                                            var clickedRatingValue = $(this).attr('value');
                                            updateRatingValue(clickedRatingValue);
                                        });

                                        var initialRating = $('.star_rating > .star.on').last().attr('value');
                                        updateRatingValue(initialRating);

                                        function addFile(input) {
                                            var maxFileCnt = 3;
                                            var attFileCnt = $('.filebox').length;
                                            var remainFileCnt = maxFileCnt - attFileCnt;
                                            var curFileCnt = input.files.length;

                                            if (curFileCnt > remainFileCnt) {
                                                alert("첨부파일은 최대 " + maxFileCnt + "개 까지 첨부 가능합니다.");
                                                return;
                                            }

                                            for (var i = 0; i < Math.min(curFileCnt, remainFileCnt); i++) {
                                                const file = input.files[i];

                                                if (validation(file)) {
                                                    filesArr.push(file);
                                                    var reader = new FileReader();
                                                    reader.onload = (function(file, fileNo) {
                                                        return function(e) {
                                                            var htmlData = '';
                                                            htmlData += '<div id="file' + fileNo + '" class="filebox" style="margin-right:20px;">';
                                                            htmlData += '   <p class="name" style="margin-bottom:0px;">' + file.name + '</p>';
                                                            htmlData += '   <a class="delete" data-file-no="' + fileNo + '" style="color:RED;">X</a>';
                                                            htmlData += '</div>';
                                                            $('.file-list').append(htmlData);

                                                            var previewHtml = '<img src="' + e.target.result + '" alt="미리보기" id="preview' + fileNo + '">';
                                                            $('.preview-container').append(previewHtml);

                                                            $('.placeholder').hide();
                                                        };
                                                    })(file, fileNo);
                                                    reader.readAsDataURL(file);
                                                }
                                                fileNo++;
                                            }
                                            $(input).val("");
                                        }

                                        function validation(file) {
                                            const fileTypes = ['image/gif', 'image/jpeg', 'image/png', 'image/bmp', 'image/tif'];
                                            if (file.name.length > 100) {
                                                alert("파일명이 100자 이상인 파일은 제외되었습니다.");
                                                return false;
                                            } else if (file.size > (100 * 1024 * 1024)) {
                                                alert("최대 파일 용량인 100MB를 초과한 파일은 제외되었습니다.");
                                                return false;
                                            } else if (file.name.lastIndexOf('.') === -1) {
                                                alert("확장자가 없는 파일은 제외되었습니다.");
                                                return false;
                                            } else if (!fileTypes.includes(file.type)) {
                                                alert("첨부가 불가능한 파일은 제외되었습니다.");
                                                return false;
                                            } else {
                                                return true;
                                            }
                                        }

                                        function deleteFile(fileNo) {
                                            $("#file" + fileNo).remove();
                                            filesArr.splice(fileNo, 1);

                                            $("#preview" + fileNo).remove();

                                            if ($('.filebox').length === 0) {
                                                $('.placeholder').show();
                                            }
                                        }

                                        $('#productimage').on('change', function() {
                                            addFile(this);
                                        });

                                        $('.file-list').on('click', '.delete', function() {
                                            var fileNo = $(this).data('file-no');
                                            deleteFile(fileNo);
                                        });

                                        // 리뷰 등록 버튼 클릭 이벤트
                                        $('#submitReview').on('click', function(event) {
                                            event.preventDefault();

                                            var productIdValue = $('.product_Id').val();
                                            var reviewContent = $('.review_box').val();
                                            var formData = new FormData();

                                            formData.append('productId', productIdValue);
                                            formData.append('rating', ratingValue); // 전역 변수 사용
                                            formData.append('content', reviewContent);

                                            // 파일 배열이 비어있는 경우를 처리
                                            if (filesArr.length > 0) {
                                                filesArr.forEach(function(file, index) {
                                                    formData.append('files[]', file);
                                                });
                                            } else {
                                                formData.append('files', new Blob()); // 빈 Blob을 추가하여 빈 파일 배열을 전송
                                            }

                                            $.ajax({
                                                url: '/reviews/add',
                                                type: 'POST',
                                                data: formData,
                                                contentType: false,
                                                processData: false,
                                                success: function(response) {
                                                    alert('리뷰가 성공적으로 등록되었습니다.');
                                                    location.reload(); // 성공 후 페이지 새로고침 또는 다른 동작
                                                },
                                                error: function(error) {
                                                    alert('리뷰 등록에 실패했습니다.');
                                                }
                                            });
                                        });
                                    });
                                </script>
                                <textarea class="review_box" placeholder="리뷰 내용을 작성해주세요."></textarea>
                                <input type="button" class="btn02" id="submitReview" value="리뷰 등록">
                            </div>
                            <hr>
                            <div name="selectReview">
                                <div th:each="review, iterStat : ${reviewList}">
                                    <div th:id="reviewItem-" + ${review.reviewId}>
                                        <h4 th:text="${review.buyer.buyerId}"></h4>
                                        <div class="review-Date" th:text="'작성날짜 :' + ${review.reviewDate}"></div>
                                        <div class="star_rating">
                                            <span class="review-star" th:attr="data-review-id=${review.reviewId}" value="1"></span>
                                            <span class="review-star" th:attr="data-review-id=${review.reviewId}" value="2"></span>
                                            <span class="review-star" th:attr="data-review-id=${review.reviewId}" value="3"></span>
                                            <span class="review-star" th:attr="data-review-id=${review.reviewId}" value="4"></span>
                                            <span class="review-star" th:attr="data-review-id=${review.reviewId}" value="5"></span>
                                            <div th:text="${review.reviewRating}" th:attr="id='reviewRating-' + ${review.reviewId}" style="display:none"></div>
                                            <div th:text="${'별점 : '+review.reviewRating}"></div>
                                        </div>
                                        <div class="review-content">
                                            <span th:text="${review.reviewContent}"></span>
                                        </div>
                                        <div class="d-flex" th:if="${review.reviewImages != null && !review.reviewImages.isEmpty()}">
                                            <div th:each="reviewImage : ${review.reviewImages}" class="review-image"
                                                 style="width:100px; height:100px; margin-right:30px; border:1px solid black;"
                                                 th:attr="data-review-id=${review.reviewId}">
                                                <img th:src="@{'/assets/image/reviewImage/'+ ${reviewImage.reviewImageSname} + ${reviewImage.reviewImageExtension}}" alt="" style="width:100%; height:100%; object-fit:cover;">
                                            </div>
                                        </div>
                                        <div th:if="${review.reviewImages != null && !review.reviewImages.isEmpty()}"
                                             class="imageLarge" style="margin-top:10px;">
                                            <button th:attr="id='toggleSizeButton-' + ${review.reviewId}" class="btn btn-dark">이미지 확대</button>
                                        </div>
                                        <div>
                                            <button th:attr="id='deleteButton-' + ${review.reviewId}" th:data-review-id="${review.reviewId}" class="btn btn-danger">삭제</button>
                                        </div>
                                        <script>
                                            $(document).ready(function() {
                                                var reviewId = [[${review.reviewId}]];
                                                var reviewRating = parseInt($('#reviewRating-' + reviewId).text());

                                                $('.review-star[data-review-id="' + reviewId + '"]').removeClass('on');
                                                for (var i = 1; i <= reviewRating; i++) {
                                                    $('.review-star[data-review-id="' + reviewId + '"][value="' + i + '"]').addClass('on');
                                                }

                                                $('#toggleSizeButton-' + reviewId).on('click', function() {
                                                    const $button = $(this);
                                                    const isExpanded = $button.text() === '이미지 축소';

                                                    $('.review-image[data-review-id="' + reviewId + '"]').css({
                                                        'width': isExpanded ? '100px' : '300px',
                                                        'height': isExpanded ? '100px' : '300px'
                                                    });

                                                    $button.text(isExpanded ? '이미지 확대' : '이미지 축소');
                                                });

                                                $('#deleteButton-' + reviewId).on('click', function() {
                                                    var reviewId = $(this).data('review-id'); // 데이터 속성을 통해 리뷰 ID 가져오기

                                                    if (confirm('정말로 이 리뷰를 삭제하시겠습니까?')) {
                                                        $.ajax({
                                                            url: '/reviews/delete/' + reviewId, // 삭제할 리뷰의 엔드포인트
                                                            type: 'DELETE',
                                                            success: function(result) {
                                                                alert('리뷰가 삭제되었습니다.');
                                                                // 삭제 후 필요한 작업 수행 (예: 화면 새로고침)
                                                                location.reload();
                                                            },
                                                            error: function(err) {
                                                                alert('리뷰 삭제에 실패했습니다.');
                                                            }
                                                        });
                                                    }
                                                });

                                                $('#updateButton-' + reviewId).on('click', function() {
                                                    // 리뷰 데이터를 가져와 폼 필드에 설정
                                                    var reviewContent = $(this).closest('[th\\:id="reviewItem-' + reviewId + '"]').find('.review-content span').text();
                                                    var reviewRating = parseInt($('#reviewRating-' + reviewId).text());

                                                    // 리뷰 등록 폼 필드에 데이터 설정
                                                    $('#reviewContent').val(reviewContent); // 리뷰 내용 설정
                                                    $('.star').removeClass('on'); // 별점 초기화
                                                    for (var i = 1; i <= reviewRating; i++) {
                                                        $('.star[value="' + i + '"]').addClass('on'); // 별점 설정
                                                    }
                                                    // 필요한 경우, 이미지 미리보기 및 기타 필드도 설정

                                                    // 폼을 보여주거나 탭 전환 등 UI 업데이트
                                                    $('#reviewFormContainer').show(); // 예시: 폼이 숨겨져 있는 경우 보이도록 설정
                                                    $('html, body').animate({ scrollTop: $('#reviewFormContainer').offset().top }, 'slow'); // 폼으로 스크롤 이동
                                                });
                                            });
                                        </script>
                                        <hr>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <script>
                            $(document).ready(function() {
                                $('.tab').click(function() {
                                    var tabId = $(this).data('tab');

                                    $('.tab').removeClass('active');
                                    $(this).addClass('active');

                                    $('.tab-content').removeClass('active');
                                    $('#' + tabId).addClass('active');
                                });

                                // 처음 로드될 때 '상품정보' 탭이 활성화된 상태로 설정
                                $('.tab[data-tab="product-info"]').click();
                            });

                        </script>
                    </div>
                </div>
            </div>
        </div>
    </section>
    </div>
</th:block>
</html>